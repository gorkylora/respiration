<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio de Respiraci√≥n AR</title>
    
    <!-- Versiones ESTABLES que funcionan -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: black;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            text-align: center;
        }

        #loading.hidden {
            display: none;
        }

        .social-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 9999;
        }

        .social-btn {
            width: 50px;
            height: 50px;
            background: #4cc9f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-size: 1.3em;
            border: 2px solid white;
        }

        #instructions {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            z-index: 9998;
            text-align: center;
            max-width: 90%;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>üåø Cargando Experiencia AR</h2>
        <p>Por favor, permite el acceso a la c√°mara</p>
    </div>

    <div id="instructions">Enfoca el marcador con tu c√°mara</div>

    <!-- ESCENA AR - CONFIGURACI√ìN SIMPLE QUE FUNCIONA -->
    <a-scene 
        vr-mode-ui="enabled: false"
        embedded 
        arjs='sourceType: webcam; debugUIEnabled: false;'
        renderer="antialias: true; alpha: true">

        <!-- USAR MARCADOR HIRO (EL M√ÅS CONFIABLE) -->
        <a-marker preset="hiro">
            <a-plane 
                position="0 0.5 0"
                width="1.6"
                height="0.9"
                rotation="-90 0 0"
                material="shader: flat; src: #video-texture;"
                onclick="toggleVideo()">
            </a-plane>
            
            <a-text value="EJERCICIO DE RESPIRACI√ìN" 
                   position="0 1.3 0" 
                   align="center" 
                   color="#4cc9f0"
                   scale="1.5 1.5 1.5">
            </a-text>
        </a-marker>

        <!-- C√ÅMARA -->
        <a-entity camera></a-entity>
    </a-scene>

    <!-- VIDEO OCULTO QUE SE USA COMO TEXTURA -->
    <video id="video-source" 
           src="respiracion.mp4" 
           loop 
           crossorigin="anonymous" 
           style="display: none;">
    </video>

    <!-- BOTONES SOCIALES -->
    <div class="social-buttons">
        <a href="https://instagram.com/tu_usuario" class="social-btn" target="_blank">
            <i class="fab fa-instagram"></i>
        </a>
        <a href="https://wa.me/1234567890" class="social-btn" target="_blank">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="tel:1234567890" class="social-btn">
            <i class="fas fa-phone"></i>
        </a>
        <a href="https://tusitio.com" class="social-btn" target="_blank">
            <i class="fas fa-globe"></i>
        </a>
    </div>

    <script>
        // ESPERAR A QUE AFRAME CARGUE
        window.addEventListener('DOMContentLoaded', function() {
            console.log('P√°gina cargada, inicializando AR...');
            
            // CREAR TEXTURA DE VIDEO MANUALMENTE (M√ÅS CONFIABLE)
            const video = document.getElementById('video-source');
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('loaded', function() {
                console.log('Escena AR cargada');
                
                // Ocultar loading
                setTimeout(function() {
                    document.getElementById('loading').classList.add('hidden');
                }, 2000);
                
                // Intentar cargar video
                video.load();
                video.play().catch(function(error) {
                    console.log('Autoplay bloqueado, necesita interacci√≥n');
                });
            });
            
            // CREAR MATERIAL DE VIDEO
            const videoTexture = new THREE.VideoTexture(video);
            const videoMaterial = new THREE.MeshBasicMaterial({ 
                map: videoTexture,
                transparent: true,
                opacity: 1
            });
            
            // ESPERAR A QUE EL VIDEO CARGUE
            video.addEventListener('loadeddata', function() {
                console.log('Video cargado correctamente');
                videoTexture.needsUpdate = true;
            });
            
            video.addEventListener('error', function(e) {
                console.error('Error cargando video:', e);
                document.getElementById('instructions').innerHTML = 
                    'Error con el video. Recarga la p√°gina.';
            });
        });

        // DETECTAR MARCADOR
        const marker = document.querySelector('a-marker');
        const instructions = document.getElementById('instructions');
        
        if (marker) {
            marker.addEventListener('markerFound', function() {
                console.log('MARCADOR DETECTADO!');
                instructions.innerHTML = '‚úÖ Marcador detectado';
                instructions.style.background = '#4cc9f0';
                instructions.style.color = 'black';
                
                // REPRODUCIR VIDEO CUANDO SE DETECTA MARCADOR
                const video = document.getElementById('video-source');
                video.play().catch(function(error) {
                    console.log('Esperando interacci√≥n para reproducir video...');
                });
            });
            
            marker.addEventListener('markerLost', function() {
                console.log('Marcador perdido');
                instructions.innerHTML = 'Enfoca el marcador con tu c√°mara';
                instructions.style.background = 'rgba(0,0,0,0.8)';
                instructions.style.color = 'white';
            });
        }

        // FUNCI√ìN PARA PAUSAR/REANUDAR VIDEO
        function toggleVideo() {
            const video = document.getElementById('video-source');
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        }

        // PERMITIR REPRODUCCI√ìN AL TOCAR LA PANTALLA
        document.addEventListener('click', function() {
            const video = document.getElementById('video-source');
            if (video.paused) {
                video.play().catch(function(error) {
                    console.log('Intentando reproducir video...');
                });
            }
        });

        // MANEJAR ERRORES GLOBALES
        window.addEventListener('error', function(e) {
            console.error('Error global:', e.error);
        });
    </script>
</body>
</html>
