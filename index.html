<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio de Respiraci√≥n AR</title>
    
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: black;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            text-align: center;
        }

        #loading.hidden {
            display: none;
        }

        .social-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 9999;
        }

        .social-btn {
            width: 50px;
            height: 50px;
            background: #4cc9f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-size: 1.3em;
            border: 2px solid white;
        }

        #instructions {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            z-index: 9998;
            text-align: center;
            max-width: 90%;
        }

        .debug-info {
            position: fixed;
            top: 80px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9997;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>üåø Cargando Experiencia AR</h2>
        <p>Audio detectado - Configurando video...</p>
    </div>

    <div id="instructions">Enfoca el marcador HIRO con tu c√°mara</div>
    <div class="debug-info" id="debug"></div>

    <!-- ESCENA AR SIMPLIFICADA -->
    <a-scene 
        vr-mode-ui="enabled: false"
        embedded 
        arjs='sourceType: webcam; debugUIEnabled: false;'
        renderer="colorManagement: true;">

        <!-- MARCADOR HIRO -->
        <a-marker id="main-marker" preset="hiro" emitevents="true" smooth="true">
            
            <!-- VIDEO VISIBLE - FORMATO CORRECTO -->
            <a-video
                id="breathing-video"
                src="respiracion.mp4"
                position="0 0.5 0"
                width="1.6"
                height="0.9"
                rotation="0 0 0"  <!-- QUITAMOS ROTACI√ìN -->
                autoplay="true"
                loop="true"
                preload="auto"
                crossorigin="anonymous"
                material="shader: flat; transparent: true; alphaTest: 0.5"
                visible="true">
            </a-video>

            <!-- MARCO DE REFERENCIA -->
            <a-plane
                position="0 0.5 0.01"
                width="1.7"
                height="1.0"
                color="#4cc9f0"
                opacity="0.3"
                transparent="true">
            </a-plane>

            <a-text value="RESPIRACI√ìN CONSCIENTE" 
                   position="0 1.4 0" 
                   align="center" 
                   color="#4cc9f0"
                   scale="1.2 1.2 1.2">
            </a-text>

            <a-text value="Toca para pausar/reanudar" 
                   position="0 -0.8 0" 
                   align="center" 
                   color="#ffffff"
                   scale="0.7 0.7 0.7">
            </a-text>

        </a-marker>

        <a-entity camera></a-entity>
        
        <!-- LUZ ADICIONAL PARA MEJORAR VISIBILIDAD -->
        <a-entity light="type: ambient; color: #FFFFFF; intensity: 1.0"></a-entity>
        <a-entity light="type: directional; color: #FFFFFF; intensity: 0.8" position="1 1 1"></a-entity>
    </a-scene>

    <!-- BOTONES SOCIALES -->
    <div class="social-buttons">
        <a href="https://instagram.com/tu_usuario" class="social-btn" target="_blank">
            <i class="fab fa-instagram"></i>
        </a>
        <a href="https://wa.me/1234567890" class="social-btn" target="_blank">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="tel:1234567890" class="social-btn">
            <i class="fas fa-phone"></i>
        </a>
        <a href="https://tusitio.com" class="social-btn" target="_blank">
            <i class="fas fa-globe"></i>
        </a>
    </div>

    <script>
        // DEBUG: Mostrar informaci√≥n √∫til
        const debug = document.getElementById('debug');
        
        function updateDebug(info) {
            debug.innerHTML = info;
            console.log('DEBUG:', info);
        }

        // INICIALIZACI√ìN
        window.addEventListener('DOMContentLoaded', function() {
            updateDebug('P√°gina cargada');
            
            const scene = document.querySelector('a-scene');
            const video = document.getElementById('breathing-video');
            const instructions = document.getElementById('instructions');
            const marker = document.getElementById('main-marker');

            // CUANDO LA ESCENA CARGA
            scene.addEventListener('loaded', function() {
                updateDebug('Escena AR cargada');
                
                setTimeout(function() {
                    document.getElementById('loading').classList.add('hidden');
                    updateDebug('Esperando marcador...');
                }, 2000);
            });

            // MANEJAR VIDEO
            if (video) {
                video.addEventListener('loadeddata', function() {
                    updateDebug('‚úÖ Video cargado - Audio OK');
                    instructions.innerHTML += '<br>‚úÖ Video listo';
                });

                video.addEventListener('canplay', function() {
                    updateDebug('Video puede reproducirse');
                });

                video.addEventListener('play', function() {
                    updateDebug('‚ñ∂Ô∏è Video reproduci√©ndose');
                });

                video.addEventListener('error', function(e) {
                    updateDebug('‚ùå Error video: ' + e.message);
                });

                // VERIFICAR VISIBILIDAD DEL VIDEO
                setTimeout(function() {
                    const videoEl = video.components.material.material.map.image;
                    if (videoEl && videoEl.videoWidth > 0) {
                        updateDebug(`Video: ${videoEl.videoWidth}x${videoEl.videoHeight}`);
                    } else {
                        updateDebug('Video element no visible');
                    }
                }, 3000);
            }

            // DETECCI√ìN DE MARCADOR
            if (marker) {
                marker.addEventListener('markerFound', function() {
                    updateDebug('üéØ Marcador DETECTADO');
                    instructions.innerHTML = '‚úÖ Marcador detectado - Video activo';
                    instructions.style.background = '#4cc9f0';
                    instructions.style.color = 'black';
                    
                    // FORZAR VISIBILIDAD DEL VIDEO
                    video.setAttribute('visible', 'true');
                    
                    // INTENTAR REPRODUCIR
                    video.play().catch(function(error) {
                        updateDebug('Autoplay bloqueado: ' + error.message);
                    });
                });

                marker.addEventListener('markerLost', function() {
                    updateDebug('üîç Marcador perdido');
                    instructions.innerHTML = 'Enfoca el marcador HIRO';
                    instructions.style.background = 'rgba(0,0,0,0.8)';
                    instructions.style.color = 'white';
                });
            }

            // CONTROL DE VIDEO AL TOCAR
            video.addEventListener('click', function(e) {
                e.stopPropagation();
                if (video.paused) {
                    video.play();
                    updateDebug('‚ñ∂Ô∏è Video reanudado');
                } else {
                    video.pause();
                    updateDebug('‚è∏Ô∏è Video pausado');
                }
            });

            // PERMITIR REPRODUCCI√ìN AL TOCAR CUALQUIER PARTE
            document.addEventListener('click', function() {
                if (video.paused) {
                    video.play().then(function() {
                        updateDebug('‚ñ∂Ô∏è Video iniciado por touch');
                    }).catch(function(error) {
                        updateDebug('Touch blocked: ' + error.message);
                    });
                }
            });

            // VERIFICAR ESTADO CADA 2 SEGUNDOS
            setInterval(function() {
                if (video) {
                    const state = video.paused ? '‚è∏Ô∏è Pausado' : '‚ñ∂Ô∏è Reproduciendo';
                    updateDebug(`Estado: ${state} | Marcador: ${marker.object3D.visible ? 'Visible' : 'Oculto'}`);
                }
            }, 2000);
        });

        // MANEJAR ERRORES
        window.addEventListener('error', function(e) {
            updateDebug('ERROR: ' + e.message);
        });
    </script>
</body>
</html>
